name: VHDL practice exercises CI

on:
  push:
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    name: VHDL exercises tests

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install NVC
        uses: nickg/setup-nvc@v1
        with:
          version: latest

      - name: ğŸ§ª Run VHDL tests for all practice exercises
        run: |
          for d in */; do
            folder_name=${d%/}
            echo "ğŸ§ª Testing $folder_name"
            nvc -a "$d"/*.vhd || { 
              echo "âŒ Analysis failed in $folder_name"
              exit 1
            }
            tbfile=$(ls "$d"/*_tb.vhd | head -n 1) || { 
              echo "âŒ No testbench found in $folder_name"
              exit 1
            }
            tbname=$(basename "$tbfile" .vhd)
            nvc -e "$tbname" || { 
              echo "âŒ Elaboration failed for $tbname in $folder_name"
              exit 1 
            }
            nvc -r "$tbname" --exit-severity=error || {
              echo "âŒ Simulation failed for $tbname in $folder_name"
              exit 1
            }
            echo "âœ… $folder_name passed"
          done
          echo "âœ… All tests passed!"
