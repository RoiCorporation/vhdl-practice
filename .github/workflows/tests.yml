name: VHDL practice exercises CI

on:
  push:
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    name: VHDL exercises tests

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install NVC
        uses: nickg/setup-nvc@v1
        with:
          version: latest

      - name: ðŸ§ª Run VHDL tests for all practice exercises
        run: |
          for d in */; do
            folder_name=${d%/}
            echo "ðŸ§ª Testing $folder_name"
            nvc -a "$d"/*.vhd
            tb=$(basename "$d")_tb
            # Find the testbench file (the one ending with _tb.vhd)
            tbfile=$(ls "$d"/*_tb.vhd | head -n 1)
            tbname=$(basename "$tbfile" .vhd)
            nvc -e "$tbname"
            nvc -r "$tbname" --exit-severity=error
            echo "âœ… $folder_name passed"
          done
